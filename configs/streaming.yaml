profiles:
  # Shared defaults (may be overridden per profile).
  base:
    streaming:
      codec: h264
      bitrate: 6M
      fps: 60
      gop: 60
      max_clients: 3
      nvenc_max_sessions: 0
      allow_cpu_fallback: false
      pipewire_fastpath: true
      gst_use_cuda_upload: false
    fifo:
      enabled: false
      container: mpegts
      dir: temp/streams
    go2rtc:
      enabled: false
      url: http://127.0.0.1:1984
      mode: fifo

  # Developer-friendly defaults:
  # - allow auto backend selection
  # - keep /stream.mp4 usable for the Vite dashboard (MSE)
  dev:
    streaming:
      backend: auto
      container: mp4
      allow_gst_mp4: false
      require_zero_copy: false

  # Local app defaults (Tauri / Vite spectator):
  # Strict GPU-only output (no CPU/raw-frame fallback).
  # Use go2rtc/WebRTC for viewing; MP4/MSE is not the default transport in strict mode.
  local:
    streaming:
      backend: gst
      container: mpegts
      bitrate: 10M
      fps: 30
      gop: 15
      allow_gst_mp4: true
      require_zero_copy: true
      max_clients: 3
      nvenc_max_sessions: 0
    fifo:
      enabled: true
      container: mpegts
      dir: temp/streams
    go2rtc:
      enabled: true
      url: http://127.0.0.1:1984
      mode: fifo

  # Production/training defaults:
  # - deterministic backend (GStreamer)
  # - enforce GPU-only streaming (no CPU raw-frame fallback)
  # - prefer go2rtc + FIFO distribution for viewers
  prod:
    streaming:
      backend: gst
      container: mpegts
      allow_gst_mp4: true
      require_zero_copy: true
      pipewire_fastpath: true
      gst_use_cuda_upload: true
      max_clients: 2
      nvenc_max_sessions: 2
      gop: 60
    fifo:
      enabled: true
      container: mpegts
      dir: temp/streams
    go2rtc:
      enabled: true
      url: http://127.0.0.1:1984
      mode: fifo

  # RTX 5090 / GeForce-style NVENC caps:
  # - prefer go2rtc/WebRTC for distribution
  # - allow CPU encoder fallback when NVENC sessions are exhausted (enables many concurrent streams)
  # NOTE: this relaxes strict GPU-only streaming; use only when you explicitly need >2 streams.
  rtx5090_webrtc_8:
    streaming:
      backend: auto
      container: mpegts
      allow_gst_mp4: true
      require_zero_copy: false
      allow_cpu_fallback: true
      pipewire_fastpath: true
      gst_use_cuda_upload: true
      max_clients: 3
      nvenc_max_sessions: 2
      gop: 60
    fifo:
      enabled: true
      container: mpegts
      dir: temp/streams
    go2rtc:
      enabled: true
      url: http://127.0.0.1:1984
      mode: fifo
